{% extends "base.html" %}
{% load mathfilters %}
{% load core_extras %}

{% block content %}
    {% load static %}
    {#    <div style="text-align: center">#}
    {#        {{ univ }}#}
    {#        <ul style="list-style: none;">#}
    {#            <li><a href="">all</a></li>#}
    {#            {% for category in categories %}#}
    {#                <li><a href="">{{ category.cat_name }}</a></li>#}
    {#            {% endfor %}#}
    {#        </ul>#}
    {##}
    {#    </div>#}
    {#    <div>#}
    {#        {% if user.is_active %}#}
    {#            <a href="{% url 'core:match_new' user.id %}"><img#}
    {#                    src="https://image.flaticon.com/icons/svg/1659/1659463.svg" width="200px" height="200px" alt=""></a>#}
    {#        {% endif %}#}
    {#    </div>#}
    <main id="main">
        <section id="portfolio" class="section-bg">
            <div class="container">

                <header class="section-header">
                    <h3 class="section-title">{{ univ }}에서 올라온 포스팅이에요</h3>

                </header>
                <div class="row">
                    <div class="col-lg-12">
                        <ul id="portfolio-flters">
                            <li data-filter=".filter-all" class="filter-active">All</li>

                            {% for category in categories %}
                                <li data-filter=".filter-{{ category }}">{{ category }}</li>
                            {% endfor %}

                        </ul>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <ul id="portfolio-flters">
                            <li data-filter=".filter-all" class="filter-active">All</li>

                            {% for category in categories %}
                                <li data-filter=".filter-{{ category }}">{{ category }}</li>
                            {% endfor %}

                        </ul>
                    </div>
                </div>

                <script>
                    function addMinutes(date, minutes) {
                        return new Date(date.getTime() + minutes * 60000);
                    }
                </script>

                <div class="row portfolio-container">
                    {% for key, values in tag_dic.items %}
                        <div class="col-lg-3 col-md-6 portfolio-item filter-{{ key.store_id.cat_name }} {% for value in values %}filter-{{ key.store_id.cat_name }}-{{ value.content }} {% endfor %}">
                            <div class="portfolio-wrap"
                                 style="border-radius: 10px; font-size: 1.3rem; text-align: center;">
                                <div style="background-color: rgb(0, 0, 0, 0.5); color: white;">
                                    <span>{{ key.user_id }}</span>
                                    {% with answer=key.user_id.profile.good_review|add:key.user_id.profile.bad_review %}
                                        {% if answer %}
                                            <span style="color: yellow;">
                                                {% with answer2=key.user_id.profile.good_review|mul:5|intdiv:answer %}
                                                    {% for i in answer2|range %}
                                                        <i class="fas fa-star"></i>
                                                    {% endfor %}
                                                {% endwith %}
                                            </span><br>
                                        {% else %}
                                            <span style="color: grey;"><i class="fas fa-star"></i></span><br>
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                <img src="{{ key.store_id.logo }}" class="img-fluid" alt="" style="width: 100%;">
                                <div class="portfolio-info" style="height: 70%;">
                                    <div style="">
                                        <a class='btn btn-secondary' style='' href="">매칭 신청</a><br><br>
                                        <a class="btn btn-secondary" style='cursor: pointer;'onclick="window.open('{{ key.store_id.store_url }}', 'childForm', 'width=1200, height=1200, resizable = no, scrollbars = no');">가게 상세 정보</a>
                                    </div>
                                </div>
                                <div style="color: white; background-color: rgb(0, 0, 0, 0.5)">
                                    <span>{{ key }}</span><br>
                                    <span>{{ key.store_id.min_price }}</span><br>
                                    <span id="clock_{{ key.pk }}" style="color: white"></span><br>
                                    <span>메뉴 : {{ key.menu }}</span><br>
                                    {% if values %}
                                        <span style="color: skyblue;">{% for value in values %}
                                            #{{ value.content }} {% endfor %}</span><br>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <script>
                            // Set the date we're counting down to
                            console.log('hello')
                            {#console.log(countDownDate);#}
                            {#console.log(due_date);#}
                            // Update the count down every 1 second
                            var x = setInterval(function () {
                                var now = new Date().getTime();
                                var create_date_{{ key.pk }} = '{{ key.create_date_string }}'
                                var create_date_{{ key.pk }}_js = new Date(create_date_{{ key.pk }});
                                var due_date_{{ key.pk }} = addMinutes(create_date_{{ key.pk }}_js, {{ key.timer }})
                                {#console.log(due_date_{{ key.pk }})#}
                                // Get today's date and time
                                // Find the distance between now and the count down date
                                var distance = due_date_{{ key.pk }} - now;
                                console.log('distance: ' + distance)
                                // Time calculations for days, hours, minutes and seconds
                                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                var seconds = Math.floor((distance % (1000 * 60)) / 1000);


                                // Output the result in an element with id="demo"
                                document.getElementById("clock_{{ key.pk }}").innerHTML = hours + ":"
                                    + minutes + ":" + seconds;

                                // If the count down is over, write some text
                                if (distance < 0) {
                                    clearInterval(x);
                                    document.getElementById("clock_{{ key.pk }}").innerHTML = "expired";
                                }
                            }, 1000);







                        </script>

                    {% endfor %}
                </div>
            </div>


        </section><!-- #portfolio -->
    </main>

{% endblock %}


